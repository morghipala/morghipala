<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Invio colori a BLE</title>
  <script src="https://unpkg.com/web-bluetooth@2/dist/web-bluetooth.min.js"></script>
  <script>
    // Funzione per richiedere l'accesso al dispositivo BLE
    function requestDevice() {
      navigator.bluetooth.requestDevice()
        .then(device => {
          console.log('Dispositivo BLE selezionato:', device.name);
          connectDevice(device);
        })
        .catch(error => {
          console.error('Errore durante la richiesta del dispositivo:', error);
        });
    }

    // Funzione per connettersi al dispositivo BLE selezionato
    function connectDevice(device) {
      device.gatt.connect()
        .then(gatt => {
          console.log('Connesso al dispositivo BLE:', device.name);
          sendColors(gatt);
        })
        .catch(error => {
          console.error('Errore durante la connessione al dispositivo:', error);
        });
    }

    // Funzione per inviare i colori al dispositivo BLE
    function sendColors(gatt) {
      // Modifica i valori di 'colors' con i colori RGB desiderati
      const colors = '255,0,0;0,255,0;0,0,255;128,128,128;255,255,0;0,255,255;255,0,255;128,0,128';

      // Trova il servizio BLE appropriato
      gatt.getPrimaryService('19b10000-e800-0000-251d-4fb18b3d3edd')
        .then(service => {
          // Trova la caratteristica BLE appropriata
          service.getCharacteristic('19b10001-e800-0000-251d-4fb18b3d3edd')
            .then(characteristic => {
              // Invia i colori alla caratteristica BLE
              characteristic.writeValue(new Uint8Array(colors.split(';').map(color => color.split(',').map(Number))));
              console.log('Colori inviati al dispositivo BLE:', colors);
            })
            .catch(error => {
              console.error('Errore durante l\'invio dei colori:', error);
            });
        })
        .catch(error => {
          console.error('Errore durante la ricerca del servizio BLE:', error);
        });
    }
  </script>
</head>
<body>
  <h1>Invio colori a dispositivo BLE</h1>

  <button onclick="requestDevice()">Seleziona dispositivo BLE</button>
</body>
</html>
